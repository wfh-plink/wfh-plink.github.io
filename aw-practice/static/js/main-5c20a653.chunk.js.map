{"version":3,"sources":["../dr-comp-package/doc-app/doc-ui-common/client/animation/AnimatableRoutes.module.scss","../dr-comp-package/main/redux-toolkit-observable/es/react-redux-helper.js","../dr-comp-package/doc-app/doc-ui-common/client/components/layout/MediaMatch.module.scss","../dr-comp-package/doc-app/doc-ui-common/client/animation/SwitchAnim.tsx","../dr-comp-package/doc-app/doc-ui-common/client/animation/AnimatableRoutes.tsx","../dr-comp-package/doc-app/doc-ui-common/client/material/TopAppBar.tsx","../dr-comp-package/doc-app/doc-ui-common/client/material/LinearProgress.tsx","../dr-comp-package/doc-app/doc-ui-common/client/components/layout/MediaMatch.tsx","../dr-comp-package/doc-app/doc-ui-common/client/components/AppLayout.tsx","../dr-comp-package/doc-app/doc-ui-common/client/components/ShowTopLoading.tsx","packages/aw-main/configurable/routes.tsx","packages/aw-main/main/Main.tsx","packages/aw-main/index.tsx","../dr-comp-package/doc-app/doc-ui-common/client/components/appLayout.state.tsx","../dr-comp-package/main/redux-toolkit-observable/es/helper.js","../dr-comp-package/main/redux-toolkit-observable/es/state-factory-browser.js","../dr-comp-package/doc-app/doc-ui-common/client/components/AppLayout.module.scss","../dr-comp-package/doc-app/doc-ui-common/client/animation/SwitchAnim.module.scss","../dr-comp-package/main/redux-toolkit-observable/es/tiny-redux-toolkit-hook.js","../dr-comp-package/main/redux-toolkit-observable/es/tiny-redux-toolkit.js","../dr-comp-package/main/redux-toolkit-observable/es/redux-toolkit-observable.js"],"names":["module","exports","COMPONENT_ID","useReduxTookitWith","stateFactory","optsFactory","epicFactories","willUnmountSub","React","useMemo","rx","sliceOptions","epic$s","map","useState","initialState","state","setState","helper","createSliceHelper","Object","assign","name","sliceStore","pipe","op","changed","subscribe","epicFac$","addEpic$","forEach","fac","idx","next","useEffect","complete","destroy","useRtk","props","extendOptsFactory","useCallback","opts","reducers","withBaseReducers","stateAndSlice","actionDispatcher","_syncComponentProps","values","_willUnmount","origReducers","s","payload","componentProps","useStoreOfStateFactory","undefined","reduxStore","setReduxStore","store$","store","demoReducers","createReducers","hellow","addEpic","slice","action$","actionStreams","castByActionType","actions","cx","classnames","bind","styles","CONTENT_KEY_SEED","setBaseOptions","contentRerendered","keyOfEntering","contentByKey","renderable","contentKeys","length","lastKey","switchContent","enterStart","key","node","clsName","anim","onContainerReady","div","dom","freeze","push","leaving","keyOfLeaving","content","style","width","clientWidth","height","clientHeight","top","left","entering","removeOldContent","indexOf","splice","switchContentDone","epicFactory","ofType","state$","getValue","hasExisting","animFirstContent","ofPayloadAction","a","type","setTimeout","Promise","resolve","SwitchAnim","useTinyReduxTookit","size","debug","children","contentHash","className","parentDom","clsddp","scope","item","cls","movingBox","ref","rootCls","RouteMatchCtx","createContext","reducer","action","AnimatableRoutes","prop","useReducer","matchedIdx","routeMatch","dispatcher","location","useLocation","rootRef","useRef","layout","useAppLayout","i","matched","routes","route","match","matchPath","pathname","scrollTo","clsDdp","Provider","value","current","typeStyleMap","standard","header","main","fixed","prominent","dense","short","TopAppBar","sub$","onDivReady","_onHeaderRef","mdc","MDCTopAppBar","getMdcRef","useImperativeHandle","toPromise","headerStyle","mainStyle","classNameHeader","title","role","right","belowHeader","renderMain","classNameMain","Forwarded","forwardRef","LinearProgress","api$","onRef","mdcInstance","MDCLinearProgress","api","determinate","open","close","MediaMatch","detectorRef","resizeEvent$","sub","window","getComputedStyle","onChange","replace","onResize","addEventListener","removeEventListener","unsubscribe","AppLayout","containerRef","scrollEvent$","sliceOptionFactory","onScrollRaw","event","trailing","_onScroll","_setTopBarRef","frontLayerClassName","barTitle","topAppBarType","mainClasName","backLayer","deviceSize","progressBarContainer","_setLoadingBarRef","routeProgressBar","showTopLoading","_setFrontLayerRef","frontLayer","onScroll","footer","_setTopAppBarDomRef","_setDeviceSize","ShowTopLoading","setLoadingVisible","LazyLandingComponent","loadable","default","fallback","path","rootEl","document","getElementById","test","navigator","userAgent","body","Main","basename","process","REACT_APP_routeBasename","from","exact","to","configureStore","MainWithStore","container","ReactDOM","render","Ctx","useContext","updateBarTitle","toUpperCase","updateFooter","visible","showTopLoadingReqsCount","pos","_setLoadingVisible","topAppBarRef","_event","topAppBarDomRef","scrollTop","getBoundingClientRect","topLoadingBarRef","_setTopbarType","getState","s1","s2","setScrollTarget","newSlice","bindActionCreators","destory$","Subject","epicFactory$","epic","Observable","EMPTY","_action$","asObservable","of","destroy$","removeSlice","getStore","sliceState","simpleReducers","rReducers","sReducer","entries","actionCreators","sourceSub","subscriberCnt","dispatcherByType","splitActions","reducerName","subject","defer","source","keys","isActionOfCreator","actionCreator","Refrigerator","originRef","this","immerable","enableES5","enableMapSet","StateFactory","REACT_APP_env","log$","tap","params","console","log","useTinyRtk","createSlice","src","some","ac","sliceCount4Name","opt","generateId","creator","dispatch","unprocessedAction$","actionTypes","actionCount","executingReducer","inReducer","newState","currState","shallowCopied","__ac","Error","err","caught","error","rootStore","_a","greeting","world","data","defaultSliceReducers","_change","preloadedState","BehaviorSubject","actionsToDispatch","ReplaySubject","epicSeq","debugLog","errorHandleMiddleware","reportActionError","realtimeState$","epicWithUnsub$","reducerMap","rootStoreReady","filter","take","errorSlice","errorSliceOpt","rootReducer","createRootReducer","epicMiddleware","createEpicMiddleware","cfgOpt","ourMiddlwares","devTools","middleware","exitingMid","getDefault","serializableCheck","immutableCheck","distinctUntilChanged","run","dependencies","epicId","mergeMap","unsub","takeUntil","catchError","_opt","_init","draft","isLazy","reduxCreateSlice","addSliceMaybeReplaceReducer","getRootStore","newRootReducer","replaceReducer","epicName","unsubscribeEpic","ss","actionMap","doAction","combineReducers","actionError"],"mappings":"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","file":"static/js/main-5c20a653.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"scope\":\"AnimatableRoutes_scope__1Guik\"};","import { ofPayloadAction } from './redux-toolkit-observable';\nimport React from 'react';\nimport { stateFactory } from './state-factory-browser';\nimport { createSliceHelper, castByActionType, createReducers } from './helper';\nimport { useEffect, useState } from 'react';\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\nexport { ofPayloadAction };\nlet COMPONENT_ID = 0;\nexport * from './helper';\n/**\n * Use a dedicated Redux slice store for single component instance\n * @param optsFactory\n * @param epicFactories\n */\nexport function useReduxTookitWith(stateFactory, optsFactory, ...epicFactories) {\n    const willUnmountSub = React.useMemo(() => new rx.ReplaySubject(1), []);\n    const sliceOptions = React.useMemo(optsFactory, [optsFactory]);\n    const epic$s = React.useMemo(() => {\n        return epicFactories.map(() => new rx.BehaviorSubject(null));\n    }, [epicFactories]);\n    const [state, setState] = React.useState(sliceOptions.initialState);\n    const helper = React.useMemo(() => {\n        const helper = createSliceHelper(stateFactory, Object.assign(Object.assign({}, sliceOptions), { name: sliceOptions.name + '.' + COMPONENT_ID++ }));\n        stateFactory.sliceStore(helper).pipe(op.distinctUntilChanged(), op.observeOn(rx.animationFrameScheduler), // To avoid changes being batched by React setState()\n        op.tap(changed => setState(changed)), op.takeUntil(willUnmountSub)).subscribe();\n        // Important!!\n        // Epic might contain recurive state changing logic, like subscribing on state$ stream and \n        // change state, it turns out any subscriber that subscribe state$ later than\n        // epic will get a state change event in reversed order !! So epic must be the last one to\n        // subscribe state$ stream\n        for (const epicFac$ of epic$s) {\n            helper.addEpic$(epicFac$);\n        }\n        // Let's fun epic factory as earlier as possible, so that it will not missing\n        // any action dispatched from child component, since child component's useEffect()\n        // runs earlier than parent component's\n        epicFactories.forEach((fac, idx) => epic$s[idx].next(fac));\n        return helper;\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    React.useEffect(() => {\n        epicFactories.forEach((fac, idx) => epic$s[idx].next(fac));\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, epicFactories);\n    React.useEffect(() => {\n        return () => {\n            willUnmountSub.next();\n            willUnmountSub.complete();\n            helper.destroy();\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    return [state, helper];\n}\n/**\n * Use a dedicated Redux slice store for single component instance\n * @param optsFactory\n * @param epicFactories\n */\nexport function useReduxTookit(optsFactory, ...epicFactories) {\n    return useReduxTookitWith(stateFactory, optsFactory, ...epicFactories);\n}\n/**\n * Use a dedicated Redux slice store for single component instance.\n * Unlike useReduxTookit, useRtk() accepts a State which extends BaseComponentState,\n *  useRtk() will automatically create an extra reducer \"_syncComponentProps\" for shallow coping\n * React component's properties to this internal RTK store\n * @param optsFactory\n * @param epicFactories\n * @returns [state, sliceHelper]\n */\nexport function useRtk(optsFactory, props, ...epicFactories) {\n    const extendOptsFactory = React.useCallback(() => {\n        const opts = optsFactory();\n        return Object.assign(Object.assign({}, opts), { reducers: withBaseReducers(opts.reducers) });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    useEffect(() => {\n        stateAndSlice[1].actionDispatcher._syncComponentProps(props);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, Object.values(props));\n    useEffect(() => {\n        return () => { stateAndSlice[1].actionDispatcher._willUnmount(); };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    const stateAndSlice = useReduxTookitWith(stateFactory, extendOptsFactory, ...epicFactories);\n    return stateAndSlice;\n}\nfunction withBaseReducers(origReducers) {\n    const reducers = Object.assign({ _syncComponentProps(s, { payload }) {\n            s.componentProps = Object.assign({}, payload);\n        },\n        _willUnmount(s) { } }, origReducers);\n    return reducers;\n}\nexport function useStoreOfStateFactory(stateFactory) {\n    const [reduxStore, setReduxStore] = useState(undefined);\n    useEffect(() => {\n        stateFactory.store$.subscribe({\n            next(store) {\n                setReduxStore(store);\n            }\n        });\n    }, [stateFactory.store$]);\n    return reduxStore;\n}\nconst demoState = {};\nconst simpleDemoReducers = {\n    hellow(s, payload) { }\n};\nconst demoReducers = createReducers(simpleDemoReducers);\nconst demoSlice = createSliceHelper(stateFactory, {\n    name: '_internal_',\n    initialState: demoState,\n    reducers: withBaseReducers(demoReducers)\n});\ndemoSlice.addEpic(slice => {\n    return action$ => {\n        slice.actionDispatcher._willUnmount();\n        const actionStreams = castByActionType(slice.actions, action$);\n        return rx.merge(actionStreams.hellow, actionStreams._syncComponentProps);\n    };\n});\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"MediaMatch\":\"MediaMatch_MediaMatch__J4SRp\"};","import React from 'react';\n\nimport classnames from 'classnames/bind';\nimport clsddp from 'classnames/dedupe';\nimport cls from 'classnames';\nimport styles from './SwitchAnim.module.scss';\n// import {useLightReduxObs} from '../lightReduxHooks';\nimport {useTinyReduxTookit, EpicFactory, ofPayloadAction} from '@wfh/redux-toolkit-observable/es/tiny-redux-toolkit-hook';\nimport * as op from 'rxjs/operators';\nimport * as rx from 'rxjs';\n// import get from 'lodash/get';\nconst cx = classnames.bind(styles);\n\nconst TRANSION_DURATION = 400;\ninterface BaseOptions {\n  /** 'full' works like 'flex-grow: 1;', default: 'fit' */\n  size?: 'full' | 'fit';\n  /** default false, show animation effect for first time content rendering */\n  animFirstContent?: boolean;\n  type?: 'opacity' | 'translateY';\n  className?: string;\n  debug?: boolean;\n}\n\nexport type SwitchAnimProps = React.PropsWithChildren<BaseOptions & {\n  parentDom?: {className: string} | null;\n  contentHash: any;\n}>;\n\n// const contentClassNames = [styles.leaving, styles.entering];\nlet CONTENT_KEY_SEED = 0;\n\ninterface SwitchState extends BaseOptions {\n  error?: Error;\n  contentKeys: string[];\n  contentByKey: {\n    [key: string]: {\n      clsName: string;\n      renderable: React.ReactNode;\n      key: string;\n      dom?: HTMLDivElement;\n      onContainerReady(div: HTMLDivElement | null): void;\n    };\n  };\n  keyOfEntering?: string;\n  keyOfLeaving?: string;\n}\n\nconst reducers = {\n  setBaseOptions(s: SwitchState, payload: BaseOptions) {\n    Object.assign(s, payload);\n  },\n  contentRerendered(s: SwitchState, payload: React.ReactNode) {\n    if (s.keyOfEntering && s.contentByKey[s.keyOfEntering]) {\n      s.contentByKey[s.keyOfEntering] = {\n        ...s.contentByKey[s.keyOfEntering],\n        renderable: payload\n      };\n    } else if (s.contentKeys.length > 0) {\n      const lastKey = s.contentKeys[s.contentKeys.length - 1];\n      s.contentByKey[lastKey] = {\n        ...s.contentByKey[lastKey],\n        renderable: payload\n      };\n    }\n    return {...s};\n  },\n  switchContent(s: SwitchState, payload: React.ReactNode) {\n    // console.log('switch content:', (payload as any)?._source?.fileName);\n  },\n  enterStart(s: SwitchState, payload: {node: React.ReactNode; anim: boolean}) {\n    // s.entering = true;\n    const key = '' + CONTENT_KEY_SEED++;\n    s.keyOfEntering = key;\n    s.contentByKey[key] = {\n      renderable: payload.node,\n      key,\n      clsName: payload.anim ? cx('enterStart') : '',\n      onContainerReady(div) {\n        if (div)\n          s.contentByKey[key] = {\n            ...s.contentByKey[key],\n            dom: div\n          };\n      }\n    };\n    Object.freeze(s.contentByKey[key]);\n    s.contentKeys.push(key);\n  },\n  leaving(s: SwitchState) {\n    if (s.contentKeys.length > 1) {\n      s.keyOfLeaving = s.contentKeys[0];\n      const content = s.contentByKey[s.keyOfLeaving];\n      content.clsName = styles.leaving;\n      if (content.dom) {\n        const style = content.dom.style;\n        style.width = content.dom.clientWidth + 'px';\n        style.height = content.dom.clientHeight + 'px';\n        style.top = '0px';\n        style.left = '0px';\n      }\n    }\n    return s;\n  },\n  entering(s: SwitchState) {\n    const enteringContent = s.contentByKey[s.keyOfEntering!];\n    enteringContent.clsName = cx('enterStart', 'entering');\n    return {...s};\n  },\n  removeOldContent(s: SwitchState) {\n    if (s.keyOfLeaving) {\n      const key = s.keyOfLeaving;\n      delete s.contentByKey[key];\n      const idx = s.contentKeys.indexOf(key);\n      s.contentKeys.splice(idx, 1);\n      // s.leaving = false;\n      s.keyOfLeaving = undefined;\n    }\n    return {...s};\n  },\n  switchContentDone(s: SwitchState) {\n    // s.entering = false;\n    const enteringContent = s.contentByKey[s.keyOfEntering!];\n    enteringContent.clsName = '';\n    s.keyOfEntering = undefined;\n    return {...s};\n  }\n};\n\nconst epicFactory: EpicFactory<SwitchState, typeof reducers> = function(slice, ofType) {\n  return (action$, state$) => {\n\n    return rx.merge(\n      action$.pipe(ofType('switchContent'),\n        // switch to replace current one, if user frequently trigger animation\n        op.switchMap(({payload}) => {\n          if (state$.getValue().keyOfEntering != null) {\n            // If there is an entering animation ongoing, wait for \"switchContentDone\" then do \"enterStart\"\n            return action$.pipe(ofType('switchContentDone'),\n              op.take(1),\n              op.mapTo(payload)\n            );\n          } else {\n            // Do \"enterStart\"\n            return rx.of(payload);\n          }\n        }),\n        // \"enterStart\" must be seperate to another RX operator, so that can be cancelled\n        op.tap((node) => {\n          const hasExisting = state$.getValue().contentKeys.length > 0;\n          slice.actionDispatcher.enterStart({node, anim: state$.getValue().animFirstContent || hasExisting});\n        }),\n        op.ignoreElements()\n      ),\n      action$.pipe(ofPayloadAction(slice.actions.enterStart),\n        op.concatMap(async ({type, payload}) => {\n          const hasExisting = state$.getValue().contentKeys.length > 0;\n          if (hasExisting) {\n            slice.actionDispatcher.leaving();\n            setTimeout(() => {\n              slice.actionDispatcher.removeOldContent();\n            }, TRANSION_DURATION);\n          }\n          if (state$.getValue().animFirstContent || hasExisting) {\n            const type = state$.getValue().type;\n            await new Promise(resolve => setTimeout(resolve, type === 'translateY' || type == null ? 200 : 20));\n            slice.actionDispatcher.entering();\n            await new Promise(resolve => setTimeout(resolve, TRANSION_DURATION));\n            slice.actionDispatcher.switchContentDone();\n          }\n        }),\n        op.ignoreElements()\n      )\n    );\n  };\n};\n\n\nconst SwitchAnim: React.FC<SwitchAnimProps> = function(props) {\n  const [state, slice] = useTinyReduxTookit(() => {\n    const initialState: SwitchState = {size: 'fit', contentKeys: [], contentByKey: {}};\n    return {\n      name: 'SwitchAnim',\n      initialState,\n      reducers,\n      debug: !!props.debug // process.env.NODE_ENV !== 'production',\n    };\n  }, epicFactory);\n\n\n  React.useEffect(() => {\n    if (props.children && slice) {\n      slice.actionDispatcher.switchContent(props.children);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.contentHash, slice]);\n\n  React.useEffect(() => {\n    if (props.children && slice) {\n      slice.actionDispatcher.contentRerendered(props.children);\n    }\n  }, [props.children, slice]);\n\n  React.useEffect(() => {\n    if (slice)\n      slice.actionDispatcher.setBaseOptions(props);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.animFirstContent, props.size, slice, props.type, props.className]);\n\n  React.useEffect(() => {\n    if (props.parentDom) {\n      props.parentDom.className = clsddp(props.parentDom.className, styles.scope, props.size == null ? 'fit' : styles[props.size]);\n    }\n  }, [props.parentDom, props.size]);\n\n  const content = state.contentKeys.map((key, idx) => {\n    const item = state.contentByKey[key];\n    return <div key={key} className={cls(styles.movingBox, item.clsName)} ref={item.onContainerReady}>{item.renderable}</div>;\n  });\n  const rootCls = cls(props.className || '', (cx(props.size == null ? 'fit' : props.size, 'scope',\n    props.type === 'opacity' ? 'animate-opacity' : '')));\n  // Your Component rendering goes here\n  return props.parentDom != null ? <>{content}</> :\n    <div className={rootCls}>{ content }</div>;\n};\n\nexport {SwitchAnim};\n\n\n\n","import React from 'react';\nimport clsDdp from 'classnames/dedupe';\nimport styles from './AnimatableRoutes.module.scss';\nimport {SwitchAnim, SwitchAnimProps} from './SwitchAnim';\nimport {useLocation, matchPath, RouteProps, match} from 'react-router-dom';\nimport {PayloadAction} from '@reduxjs/toolkit';\nimport {useAppLayout} from '../components/appLayout.state';\n// import * as rx from 'rxjs';\n// import * as op from 'rxjs/operators';\n\nexport type AnimatableRoutesProps = React.PropsWithChildren<{\n  parentDom?: {className: string} | null;\n  className?: string;\n  /** imutable */\n  routes: Array<{[p in 'path' | 'strict' | 'exact' | 'sensitive']?: RouteProps[p]} & {children: SwitchAnimProps['children']}>;\n  /**  */\n  otherMatch?: string;\n}>;\n\nconst RouteMatchCtx = React.createContext<ReturnType<typeof matchPath>>(null);\n\ninterface AnimatableRoutesState {\n  matchedIdx: number | undefined;\n  routeMatch: ReturnType<typeof matchPath> | null;\n}\n\nconst reducer: React.Reducer<AnimatableRoutesState, PayloadAction<(state: AnimatableRoutesState) => AnimatableRoutesState>> = function(s, action) {\n  return action.payload(s);\n};\n\nconst AnimatableRoutes: React.FC<AnimatableRoutesProps> = function(prop) {\n  // const location = useLocation();\n  // const [matchedIdx, setMatchedIdx] = React.useState<number>();\n  const [state, dispatcher] = React.useReducer(reducer, {matchedIdx: undefined, routeMatch: null} as AnimatableRoutesState);\n  const location = useLocation();\n  // useEffect(() => {\n  //   const actions = new rx.Subject<PayloadAction<any>>();\n  //   const sub = actions.pipe(\n  //   ).subscribe();\n  //   return () => sub.unsubscribe();\n  // }, []);\n\n  const rootRef = React.useRef<HTMLDivElement>(null);\n  const layout = useAppLayout();\n\n  React.useEffect(() => {\n    // console.log('location path:', location.pathname);\n    let i = 0;\n    let matched = false;\n    for (const route of prop.routes) {\n      const match = matchPath<{[p: string]: string}>(location.pathname, route);\n      if (match) {\n        const matchedIdx = i;\n        dispatcher({type: 'setMatched', payload: (s) => {\n          return {...s, matchedIdx, routeMatch: match};\n        }});\n        matched = true;\n        break;\n      }\n      i++;\n    }\n    if (!matched) {\n      // setMatchedIdx(undefined);\n      dispatcher({type: 'clearMatchedIdx', payload: (s) => {\n        return {...s, matchedIdx: undefined, routeMatch: null};\n      }});\n    }\n  }, [location.pathname, prop.routes]);\n\n  // When route is switched, scroll to top\n  React.useEffect(() => {\n    if (state.matchedIdx != null && layout) {\n      layout.actionDispatcher.scrollTo([0, 0]);\n    }\n  }, [layout, state.matchedIdx]);\n\n  React.useEffect(() => {\n    if (prop.parentDom) {\n      prop.parentDom.className = clsDdp(prop.parentDom.className, styles.scope, prop.className);\n    }\n  }, [prop.className, prop.parentDom]);\n\n  const content = <RouteMatchCtx.Provider value={state.routeMatch}>\n  { state.matchedIdx != null ? // prop.routes[state.matchedIdx].children :\n      <SwitchAnim debug={false} size='full' parentDom={prop.parentDom == null ? rootRef.current : prop.parentDom}\n      contentHash={state.matchedIdx}>{prop.routes[state.matchedIdx].children}</SwitchAnim> :\n      prop.children ? prop.children : <></>\n  }\n  </RouteMatchCtx.Provider>;\n\n  return prop.parentDom ? content : (\n    <div ref={rootRef} className={clsDdp(styles.scope, prop.className)}>\n      {content}\n    </div>\n  );\n};\n\n\nexport {AnimatableRoutes};\n\nexport function useParams<Params extends { [K in keyof Params]?: string } = Record<string, any>>(): Params {\n  const match = React.useContext(RouteMatchCtx);\n  return (match?.params || {}) as Params;\n}\n\nexport function useMatch<Params extends { [K in keyof Params]?: string } = Record<string, any>>()  {\n  return React.useContext(RouteMatchCtx) as match<Params>;\n}\n","import React from 'react';\nimport classnames from 'classnames/bind';\nimport cls from 'classnames';\nimport styles from './TopAppBar.scss';\nimport {MDCTopAppBar} from '@material/top-app-bar';\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\nimport {SwitchAnim} from '../animation/SwitchAnim';\nexport {MDCTopAppBar};\nconst cx = classnames.bind(styles);\n// const cls = cx('mdc-top-app-bar');\n\n// tslint:disable-next-line: no-empty-interface\n// export interface TopAppBarProps {\n//   getMdcRef?: (ref: MDCTopAppBar) => void;\n// }\n\nexport type TopAppBarProps = React.PropsWithChildren<{\n  classNameHeader?: string;\n  classNameMain?: string;\n  renderMain?: (mainAreaClassName: string) => React.ReactNode;\n  title: React.ReactNode ;\n  type?: 'fixed' | 'prominent' | 'dense' | 'short' | 'standard';\n  left?: React.ReactNode;\n  right?: React.ReactNode;\n  onDrawerMenuClick?: () => void;\n  getMdcRef?: (ref: MDCTopAppBar) => void;\n  // renderBelowHeader?: (topBarType: TopAppBarProps['type']) => React.ReactNode;\n  belowHeader?: React.ReactNode;\n  _onHeaderRef?(headerRef: HTMLHeadElement | null): void;\n}>;\n\nconst typeStyleMap: {[key in NonNullable<TopAppBarProps['type']>]: {header: string; main: string}} = {\n  standard: {header: '', main: 'mdc-top-app-bar--fixed-adjust'},\n  fixed: {header: 'mdc-top-app-bar--fixed', main: 'mdc-top-app-bar--fixed-adjust'},\n  prominent: {header: 'mdc-top-app-bar--prominent', main: 'mdc-top-app-bar--prominent-fixed-adjust'},\n  dense: {header: 'mdc-top-app-bar--dense', main: 'mdc-top-app-bar--dense-fixed-adjust'},\n  short: {header: 'mdc-top-app-bar--short', main: 'mdc-top-app-bar--short-fixed-adjust'}\n};\n\nconst TopAppBar: React.ForwardRefRenderFunction<Promise<MDCTopAppBar>, TopAppBarProps> = function(props, ref) {\n  const sub$ = React.useMemo(() => new rx.BehaviorSubject<MDCTopAppBar | null>(null), []);\n\n  const onDivReady = React.useCallback((div: HTMLHeadElement | null) => {\n    if (props._onHeaderRef)\n      props._onHeaderRef(div);\n    if (div == null) {\n      if (sub$.getValue()) {\n        sub$.getValue()!.destroy();\n        sub$.next(null);\n      }\n      return;\n    }\n    const mdc = new MDCTopAppBar(div);\n    sub$.next(mdc);\n    // sub$.complete();\n    if (props.getMdcRef) {\n      props.getMdcRef(mdc);\n    }\n  }, []);\n\n  React.useImperativeHandle(ref,\n    () => sub$.pipe(op.filter(item => item != null), op.take(1)).toPromise() as Promise<MDCTopAppBar>,\n    [sub$]);\n\n  React.useEffect(() => {\n    return () => {\n      if (sub$.getValue()) {\n        sub$.getValue()!.destroy();\n      }\n    };\n  }, [sub$]);\n\n  let headerStyle = props.type ? typeStyleMap[props.type].header : typeStyleMap.standard.header;\n  let mainStyle = props.type ? typeStyleMap[props.type].main : typeStyleMap.standard.main;\n\n  return (<>\n    <header className={cls(props.classNameHeader || '', cx('mdc-top-app-bar', headerStyle))} ref={onDivReady}>\n      <div className='mdc-top-app-bar__row'>\n        <section className='mdc-top-app-bar__section mdc-top-app-bar__section--align-start'>\n          {props.left || null}\n          {/* <button className='material-icons mdc-top-app-bar__navigation-icon mdc-icon-button' aria-label='Open navigation menu' onClick={props.onDrawerMenuClick}>menu</button> */}\n          <span className='mdc-top-app-bar__title'>\n            <SwitchAnim type='opacity' contentHash={props.title}>{props.title}</SwitchAnim>\n          </span>\n        </section>\n        <section className='mdc-top-app-bar__section mdc-top-app-bar__section--align-end' role='toolbar'>\n          {props.right || null}\n          {/* <button className='material-icons mdc-top-app-bar__action-item mdc-icon-button' aria-label='Share'>share</button>\n          <button className='material-icons mdc-top-app-bar__action-item mdc-icon-button' aria-label='Delete'>delete</button>\n          <button className='material-icons mdc-top-app-bar__action-item mdc-icon-button' aria-label='Open menu'>more_vert</button> */}\n        </section>\n      </div>\n      {props.belowHeader ? props.belowHeader : null}\n    </header>\n    {\n    props.renderMain ? props.renderMain(cls(props.classNameMain || '', cx(mainStyle))) :\n      <main className={cls(props.classNameMain || '', cx(mainStyle))}>{props.children}</main>\n    }\n    </>\n  );\n};\nconst Forwarded = React.forwardRef(TopAppBar);\n\nexport {Forwarded as TopAppBar};\n\n","import React from 'react';\nimport { MDCLinearProgress } from '@material/linear-progress';\nimport cls from 'classnames';\n// import clsddp from 'classnames/dedupe';\nimport './LinearProgress.scss';\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\n\nexport type LinearProgressProps = React.PropsWithChildren<{\n  className?: string;\n  determinate?: boolean;\n  open?: boolean;\n}>;\n\nconst LinearProgress: React.ForwardRefRenderFunction<Promise<MDCLinearProgress>, LinearProgressProps> = function(props, ref) {\n  const api$ = React.useMemo(() => new rx.ReplaySubject<MDCLinearProgress>(1), []);\n\n  const onRef = React.useCallback<React.RefCallback<HTMLDivElement>>((div) => {\n    if (div) {\n      const mdcInstance = new MDCLinearProgress(div);\n      api$.next(mdcInstance);\n    }\n  }, []);\n\n  React.useEffect(() => {\n    return () => {\n      api$.pipe(\n        op.tap(api => api.destroy()),\n        op.take(1)\n      ).subscribe();\n    };\n  }, []);\n\n  React.useImperativeHandle(ref, () => {\n    return api$.pipe(op.take(1)).toPromise();\n  });\n\n  React.useEffect(() => {\n    api$.subscribe({\n      next(api) {\n        api.determinate = !!props.determinate;\n      }\n    });\n  }, [props.determinate]);\n  React.useEffect(() => {\n    api$.subscribe({\n      next(api) {\n        if (props.open) {\n          api.open();\n        } else {\n          api.close();\n        }\n      }\n    });\n  }, [props.open]);\n  // Your Component rendering goes here\n  return <div ref={onRef} className={cls(props.className, 'LinearProgress', 'mdc-linear-progress')}\n    role='progressbar'\n      aria-label='Progress Bar' aria-valuemin={0} aria-valuemax={1} aria-valuenow={0}>\n    <div className='mdc-linear-progress__buffer'>\n      <div className='mdc-linear-progress__buffer-bar'></div>\n      <div className='mdc-linear-progress__buffer-dots'></div>\n    </div>\n    <div className='mdc-linear-progress__bar mdc-linear-progress__primary-bar'>\n      <span className='mdc-linear-progress__bar-inner'></span>\n    </div>\n    <div className='mdc-linear-progress__bar mdc-linear-progress__secondary-bar'>\n      <span className='mdc-linear-progress__bar-inner'></span>\n    </div>\n  </div>;\n};\n\nconst Forwarded = React.forwardRef(LinearProgress);\nexport {Forwarded as LinearProgress};\n\n\n\n","import React from 'react';\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\n// import cls from 'classnames';\n// import clsddp from 'classnames/dedupe';\nimport styles from './MediaMatch.module.scss';\n\nexport type Size = 'desktop' | 'tablet' | 'phone';\n\nexport type MediaMatchProps = React.PropsWithChildren<{\n  onChange(size: Size): void;\n}>;\n\nconst MediaMatch: React.FC<MediaMatchProps> = function(props) {\n  // React.useEffect(() => {\n  //   console.log(styleText);\n  // }, []);\n  const detectorRef = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    const resizeEvent$ = new rx.Subject();\n    const sub = resizeEvent$.pipe(\n      op.throttleTime(500),\n      op.concatMap(() => rx.timer(20).pipe(op.take(1))),\n      op.tap(() => {\n        if (detectorRef.current) {\n          const content = window.getComputedStyle(detectorRef.current, '::before').content;\n          props.onChange(content.replace(/^[\"']|[\"']$/g, '') as Size);\n          // console.log(window.getComputedStyle(detectorRef.current, '::before').content);\n        }\n      })\n    ).subscribe();\n\n    function onResize() {\n      resizeEvent$.next();\n    }\n    window.addEventListener('resize', onResize);\n\n    onResize();\n    return () => {\n      window.removeEventListener('resize', onResize);\n      sub.unsubscribe();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.onChange]);\n  return <div ref={detectorRef} className={styles.MediaMatch}></div>;\n  // return <></>;\n};\n\n\nexport {MediaMatch};\n\n\n\n","import React from 'react';\n\nimport classnames from 'classnames/bind';\nimport cls from 'classnames';\nimport clsDdp from 'classnames/dedupe';\nimport styles from './AppLayout.module.scss';\nimport { TopAppBar } from '@wfh/doc-ui-common/client/material/TopAppBar';\nimport {useTinyReduxTookit} from '@wfh/redux-toolkit-observable/es/tiny-redux-toolkit-hook';\nimport {sliceOptionFactory, epicFactory, Ctx} from './appLayout.state';\nimport {LinearProgress} from '@wfh/doc-ui-common/client/material/LinearProgress';\nimport {MediaMatch} from './layout/MediaMatch';\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\nimport '@material/layout-grid/mdc-layout-grid.scss';\n\nconst cx = classnames.bind(styles);\n\nexport type AppLayoutProps = React.PropsWithChildren<{\n  parentDom?: {className: string} | null;\n  className?: string;\n}>;\n\nconst AppLayout: React.FC<AppLayoutProps> = function(props) {\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const scrollEvent$ = React.useMemo(() => new rx.Subject<React.UIEvent<HTMLDivElement, UIEvent>>(), []);\n\n  const [state, slice] = useTinyReduxTookit(sliceOptionFactory, epicFactory);\n\n  React.useEffect(() => {\n    if (props.parentDom) {\n      props.parentDom.className = clsDdp(props.className || undefined, cx('container'), props.parentDom.className);\n    }\n  }, [props.parentDom, props.className]);\n\n  React.useEffect(() => {\n    if (containerRef.current) {\n      containerRef.current.className = clsDdp(props.className || undefined, cx('container'), containerRef.current.className);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [containerRef.current, props.className]);\n\n  // const progressBarRef = React.useCallback((dom: HTMLDivElement | null) => {\n  //   slice.dispatch({type: 'topLoadingBarReady', reducer(s: AppLayoutState) {\n  //     if (dom)\n  //       s.topLoadingBarRef = dom;\n  //   }});\n  // }, []);\n\n  const onScrollRaw = React.useCallback((event: React.UIEvent<HTMLDivElement, UIEvent>) => {\n    scrollEvent$.next(event);\n  }, [scrollEvent$]);\n\n  // const renderBelowHeader: TopAppBarProps['renderBelowHeader'] = (type) => {\n  //   return <div className={styles.progressBarContainer} ref={slice.actionDispatcher._setLoadingBarRef}>\n  //     <LinearProgress className={styles.routeProgressBar} determinate={false} open={state.showTopLoading}/>\n  //   </div>;\n  // };\n\n  React.useEffect(() => {\n    const sub = scrollEvent$.pipe(\n      op.throttleTime(300, undefined, {trailing: true}),\n      op.tap(event => slice.actionDispatcher._onScroll(event))\n    ).subscribe();\n    return () => sub.unsubscribe();\n  }, [scrollEvent$, slice.actionDispatcher]);\n\n  function renderMain(mainClasName: string) {\n    return <>\n    {/* Backdrop style UI https://material.io/components/backdrop#usage */}\n    <div className={cls(styles.backLayer, 'mdc-layout-size-' + state.deviceSize)}>\n      <div className={styles.progressBarContainer} ref={slice.actionDispatcher._setLoadingBarRef}>\n        <LinearProgress className={styles.routeProgressBar} determinate={false} open={state.showTopLoading}/>\n      </div>\n      <div ref={slice.actionDispatcher._setFrontLayerRef} className={cls(styles.frontLayer, mainClasName)}\n        onScroll={onScrollRaw}>\n        {props.children}\n        <footer className={styles.footer}>\n          {state.footer}\n        </footer>\n      </div>\n    </div></>;\n  }\n\n  const content = (\n    <TopAppBar ref={slice.actionDispatcher._setTopBarRef} classNameHeader={cx('app-bar-header', state.frontLayerClassName)}\n      classNameMain={cx('app-bar-main')} title={state.barTitle} type={state.topAppBarType}\n      renderMain={renderMain}\n      _onHeaderRef={slice.actionDispatcher._setTopAppBarDomRef}\n    >\n    </TopAppBar>\n  );\n\n  return <Ctx.Provider value={slice}>\n    <MediaMatch onChange={slice.actionDispatcher._setDeviceSize}/>\n    {props.parentDom == null ? <div className={props.className || undefined} ref={containerRef}>{content}</div> : content}\n    </Ctx.Provider>;\n};\n\n\nexport {AppLayout};\n\n\n\n","import React from 'react';\n\n// import cls from 'classnames';\n// import clsddp from 'classnames/dedupe';\n// import styles from './ShowTopLoading.module.scss';\nimport {useAppLayout} from './appLayout.state';\n\n\nexport type ShowTopLoadingProps = React.PropsWithChildren<{\n  // Define your component properties\n}>;\n\nconst ShowTopLoading: React.FC<ShowTopLoadingProps> = function(props) {\n  const slice = useAppLayout();\n  React.useEffect(() => {\n    if (slice)\n      slice.actionDispatcher.setLoadingVisible(true);\n\n    return () => {\n      if (slice)\n        slice.actionDispatcher.setLoadingVisible(false);\n    };\n  }, [slice]);\n  return <></>;\n};\n\n\nexport {ShowTopLoading};\n\n\n\n","import React from 'react';\nimport loadable from '@loadable/component';\nimport {ShowTopLoading} from '@wfh/doc-ui-common/client/components/ShowTopLoading';\nimport {AnimatableRoutesProps} from '@wfh/doc-ui-common/client/animation/AnimatableRoutes';\n\n// const LazyDocComponent = loadable(async () => {\n//   return (await import('../feature/article/ArticalePage')).ArticalePage;\n// }, {fallback: <ShowTopLoading/>});\n\nconst LazyLandingComponent = loadable(async () => {\n  return (await import('../pages/Landing')).default;\n}, {fallback: <ShowTopLoading/>});\n\n// const SurfaceDemo = loadable(async () => {\n//   return (await import('../feature/demo/SurfaceBackgroundDemo')).SurfaceBackgroundDemo;\n// });\n\nexport const routes: AnimatableRoutesProps['routes'] = [\n  {path: '/', children: <LazyLandingComponent/>}\n  // {path: '/doc/:mdKey', children: <LazyDocComponent/>}\n];\n\nexport const defaultRedirect = '/';\n","import '@material-icons/font/css/outline.css';\nimport { AnimatableRoutes } from '@wfh/doc-ui-common/client/animation/AnimatableRoutes';\nimport { AppLayout } from '@wfh/doc-ui-common/client/components/AppLayout';\nimport { useStoreOfStateFactory } from '@wfh/redux-toolkit-observable/es/react-redux-helper';\nimport { stateFactory } from '@wfh/redux-toolkit-observable/es/state-factory-browser';\nimport clsddp from 'classnames/dedupe';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { BrowserRouter as Router, Redirect, Switch } from 'react-router-dom';\nimport { defaultRedirect, routes } from '../configurable/routes';\n\nconst rootEl = document.getElementById('root');\nif (/\\WWindows\\W/.test(navigator.userAgent)) {\n  document.body.className = clsddp(document.body.className, 'is-windows');\n}\n\nconst Main: React.FC<Record<string, never>> = function() {\n\n  return <AppLayout parentDom={rootEl}>\n    <Router basename={process.env.REACT_APP_routeBasename}>\n      <AnimatableRoutes routes={routes}>\n        <Switch>\n          <Redirect from='/' exact to={defaultRedirect}/>\n        </Switch>\n      </AnimatableRoutes>\n    </Router>\n  </AppLayout>;\n};\n\nstateFactory.configureStore();\nexport const MainWithStore: React.FC<React.PropsWithChildren<Record<string, unknown>>> = function() {\n  const reduxStore = useStoreOfStateFactory(stateFactory);\n  if (reduxStore == null)\n    return <></>;\n  return (\n    <ReduxProvider store={reduxStore}>\n      <Main/>\n    </ReduxProvider>\n  );\n};\nexport function renderDom(dom: HTMLElement) {\n  ReactDOM.render(<MainWithStore/>, dom);\n\n  return {\n    unmount() {\n      ReactDOM.unmountComponentAtNode(dom);\n    }\n  };\n}\n\n","/// <reference path=\"react-app-env.d.ts\" />\nimport './index.scss';\nimport {renderDom} from './main/Main';\nconst container = document.getElementById('root')!;\n\nrenderDom(container);\n","/**\n * For those components which has complicated \"state\" or a lot async \"actions\",\n * leverage a Redux (Redux-toolkit, Redux-observable) like internal store to manage\n * your component.\n * \n * It's more powerful than React's useReducer() (https://reactjs.org/docs/hooks-reference.html#usereducer)\n * \n * You should be familiar with concept of \"slice\" (Redux-toolkit) and \"Epic\" (Redux-observable) first.\n * \n * Unlike real Redux-toolkit, we does not use ImmerJs inside, its your job to take care of\n * immutabilities of state, but also as perks, you can use any ImmerJS unfriendly object in state,\n * e.g. DOM object, React Component, functions\n */\nimport {EpicFactory, Slice, castByActionType} from '@wfh/redux-toolkit-observable/es/tiny-redux-toolkit-hook';\nimport { MDCTopAppBar } from '@wfh/doc-ui-common/client/material/TopAppBar';\nimport * as op from 'rxjs/operators';\nimport * as rx from 'rxjs';\nimport React from 'react';\nimport {Size} from './layout/MediaMatch';\nimport {TopAppBarProps} from '../material/TopAppBar';\n\nexport const Ctx = React.createContext<Slice<AppLayoutState, typeof reducers> | null | undefined>(null);\nexport function useAppLayout() {\n  const ctx = React.useContext(Ctx);\n  return ctx;\n}\n\nexport interface AppLayoutState {\n  barTitle?: string | null;\n  deviceSize: Size;\n  footer?: React.ReactNode;\n  /** top progress bar */\n  showTopLoading: boolean;\n  /** scrollable area */\n  frontLayer?: HTMLDivElement;\n  frontLayerClassName: string;\n  topAppBarType?: TopAppBarProps['type'];\n  topAppBarRef?: Promise<MDCTopAppBar> | null;\n  /** actually show loadin when showTopLoadingCount > 0, turning off loading when showTopLoadingCount <= 0 */\n  showTopLoadingReqsCount: number;\n  // lastScrollEvent?: React.UIEvent<HTMLDivElement, UIEvent>;\n  topLoadingBarRef?: HTMLDivElement;\n  topAppBarDomRef?: HTMLHeadElement;\n  error?: Error;\n}\n\nexport const reducers = {\n  updateBarTitle(s: AppLayoutState, title: string | null) {\n    s.barTitle = title ? title.toUpperCase() : '';\n  },\n  updateFooter(s: AppLayoutState, content: React.ReactNode) {\n    s.footer = content;\n  },\n  setLoadingVisible(s: AppLayoutState, visible: boolean) {\n    // s.showTopLoading = visible;\n    if (visible)\n      s.showTopLoadingReqsCount++;\n    else if (!visible && s.showTopLoadingReqsCount > 0)\n      s.showTopLoadingReqsCount--;\n  },\n  scrollTo(s: AppLayoutState, pos: [left: number, top: number]) {},\n  _setLoadingVisible(s: AppLayoutState, visible: boolean) {\n    s.showTopLoading = visible;\n  },\n  _setFrontLayerRef(s: AppLayoutState, div: HTMLDivElement | null) {\n    if (div) {\n      s.frontLayer = div;\n    }\n  },\n  _setTopBarRef(s: AppLayoutState, mdc: Promise<MDCTopAppBar> | null) {\n    s.topAppBarRef = mdc;\n  },\n  _onScroll(s: AppLayoutState, _event: React.UIEvent<HTMLDivElement, UIEvent> | null) {\n    // s.lastScrollEvent = event;\n    if (s.frontLayer && s.topAppBarDomRef && s.frontLayer.scrollTop + s.topAppBarDomRef.getBoundingClientRect().top > 1) {\n      s.frontLayerClassName = 'withShadow';\n    } else {\n      s.frontLayerClassName = '';\n    }\n  },\n  _setLoadingBarRef(s: AppLayoutState, dom: HTMLDivElement | null) {\n    if (dom)\n      s.topLoadingBarRef = dom;\n  },\n  _setDeviceSize(s: AppLayoutState, size: Size) {\n    s.deviceSize = size;\n  },\n  _setTopbarType(s: AppLayoutState, type: TopAppBarProps['type']) {\n    s.topAppBarType = type;\n  },\n  _setTopAppBarDomRef(s: AppLayoutState, dom: HTMLHeadElement) {\n    s.topAppBarDomRef = dom;\n  }\n  // define more reducers...\n};\n\nexport function sliceOptionFactory() {\n  const initialState: AppLayoutState = {\n    showTopLoading: false,\n    frontLayerClassName: '',\n    showTopLoadingReqsCount: 0,\n    deviceSize: 'phone'\n  };\n  return {\n    name: 'AppLayout',\n    initialState,\n    reducers,\n    debug: false // process.env.NODE_ENV !== 'production'\n  };\n}\n\nexport const epicFactory: EpicFactory<AppLayoutState, typeof reducers> = function(slice, ofType) {\n  return (action$, state$) => {\n    const actionStreams = castByActionType(slice.actions, action$);\n    return rx.merge(\n      actionStreams._setDeviceSize.pipe(\n        op.tap(({payload: size}) => {\n          slice.actionDispatcher._setTopbarType(size === 'desktop' ? 'standard' : 'dense');\n        })),\n      actionStreams.scrollTo.pipe(\n        op.switchMap(({payload}) => {\n          slice.getState().frontLayer?.scrollTo(payload[0], payload[1]);\n          return rx.timer(0);\n        }),\n        // eslint-disable-next-line array-callback-return\n        op.map(() => {\n          slice.actionDispatcher._onScroll(null);\n        })\n      ),\n      state$.pipe(\n        op.map(s => s.showTopLoadingReqsCount), op.distinctUntilChanged(),\n        op.tap(showTopLoadingReqsCount => {\n          if (showTopLoadingReqsCount > 0) {\n            slice.actionDispatcher._setLoadingVisible(true);\n          } else if (showTopLoadingReqsCount <= 0) {\n            slice.actionDispatcher._setLoadingVisible(false);\n          }\n        })\n      ),\n      state$.pipe(\n        op.distinctUntilChanged((s1, s2) => s1.topAppBarRef === s2.topAppBarRef && s1.frontLayer === s2.frontLayer),\n        op.filter(state => state.frontLayer != null && state.topAppBarRef != null),\n        op.mergeMap(async state => {\n          const mdc = await state.topAppBarRef!;\n          mdc.setScrollTarget(state.frontLayer!);\n        })\n      )\n    ).pipe(op.ignoreElements());\n  };\n};\n","import { Observable, EMPTY, of, Subject, defer } from 'rxjs';\nimport * as op from 'rxjs/operators';\nimport { immerable } from 'immer';\nexport function createSliceHelper(stateFactory, opts) {\n    const slice = stateFactory.newSlice(opts);\n    const actionDispatcher = stateFactory.bindActionCreators(slice);\n    const destory$ = new Subject();\n    let action$ = new Subject();\n    new Observable(() => {\n        // Release epic\n        return stateFactory.addEpic(_action$ => {\n            return _action$.pipe(op.tap(action => action$.next(action)), op.ignoreElements());\n        }, opts.name);\n    }).subscribe();\n    function addEpic$(epicFactory$) {\n        const sub = epicFactory$.pipe(op.distinctUntilChanged(), op.switchMap(fac => {\n            if (fac) {\n                const epic = fac(helper);\n                if (epic) {\n                    return new Observable(() => {\n                        // Release epic\n                        return stateFactory.addEpic(epic, opts.name);\n                    });\n                }\n            }\n            return EMPTY;\n        }), op.takeUntil(destory$)).subscribe();\n        // releaseEpic.push(() => sub.unsubscribe());\n        return () => sub.unsubscribe();\n    }\n    // let releaseEpic: Array<() => void> = [];\n    const helper = Object.assign(Object.assign({}, slice), { action$: action$.asObservable(), actionDispatcher, addEpic(epicFactory) {\n            return addEpic$(of(epicFactory));\n        }, addEpic$, destroy$: destory$.asObservable(), destroy() {\n            destory$.next();\n            destory$.complete();\n            stateFactory.removeSlice(slice);\n        },\n        getStore() {\n            return stateFactory.sliceStore(slice);\n        },\n        getState() {\n            return stateFactory.sliceState(slice);\n        } });\n    return helper;\n}\n/**\n * createReducers helps to simplify how we writing definition of SliceCaseReducers,\n * e.g. A regular SliceCaseReducers takes PayloadAction as parameter, like:\n * ```ts\n * const reducers = {\n *   reducerName(state: State, {payload}: PayloadAction<number>) {\n *      // update state with payload data\n *    }\n * };\n * ```\n * Normally reducer's logic only care about `payload` instead of `PayloadAction`,\n * createReducers accepts a simpler format:\n * ```ts\n * const reducers = createReducers({\n *   reducerName(draft: State, payload: number) {\n *   }\n * });\n * ```\n * You can declare payload as reducer's parameter instead of a PayloadAction\n * @param simpleReducers\n * @returns SliceCaseReducers which can be part of parameter of createSliceHelper\n */\nexport function createReducers(simpleReducers) {\n    const rReducers = {};\n    for (const [key, sReducer] of Object.entries(simpleReducers)) {\n        rReducers[key] = (s, { payload }) => {\n            return sReducer(s, payload);\n        };\n    }\n    return rReducers;\n}\n/**\n * Map action stream to multiple action streams by their action type.\n * This is an alternative way to categorize action stream, compare to \"ofPayloadAction()\"\n * Usage:\n```\nslice.addEpic(slice => action$ => {\n  const actionsByType = castByActionType(slice.actions, action$);\n  return merge(\n    actionsByType.REDUCER_NAME_A.pipe(\n      ...\n    ),\n    actionsByType.REDUCER_NAME_B.pipe(\n      ...\n    ),\n  )\n})\n```\n * @param actionCreators\n * @param action$\n */\nexport function castByActionType(actionCreators, action$) {\n    let sourceSub;\n    let subscriberCnt = 0;\n    const dispatcherByType = {};\n    const splitActions = {};\n    for (const reducerName of Object.keys(actionCreators)) {\n        const subject = dispatcherByType[actionCreators[reducerName].type] = new Subject();\n        // eslint-disable-next-line no-loop-func\n        splitActions[reducerName] = defer(() => {\n            if (subscriberCnt++ === 0)\n                sourceSub = source.subscribe();\n            return subject.asObservable();\n        }).pipe(\n        // eslint-disable-next-line no-loop-func\n        op.finalize(() => {\n            if (--subscriberCnt === 0 && sourceSub) {\n                sourceSub.unsubscribe();\n                sourceSub = undefined;\n            }\n        }));\n    }\n    const source = action$.pipe(\n    // op.share(), we don't need share(), we have implemented same logic\n    op.map(action => {\n        const match = dispatcherByType[action.type];\n        if (match) {\n            match.next(action);\n        }\n    }));\n    return splitActions;\n}\nexport function isActionOfCreator(action, actionCreator) {\n    return action.type === actionCreator.type;\n}\n/**\n * Add an epicFactory to another component's sliceHelper\n * e.g.\n * ```\n * action$.pipe(ofPayloadAction(slice.actionDispatcher._onChildSliceRef),\n *  childSliceOp((childSlice) => {\n *    return childAction$ => {\n *      return childAction$.pipe(...);\n *    };\n *  })\n * ```\n * @param epicFactory\n */\nexport function sliceRefActionOp(epicFactory) {\n    return function (in$) {\n        return in$.pipe(op.switchMap(({ payload }) => {\n            const release = payload.addEpic(epicFactory);\n            return new Observable(sub => release);\n        }));\n    };\n}\n/**\n * ImmerJS does not work with some large object (like HTMLElement), meaning you can not directly defined a\n * Redux-toolkit state to contain such a large object, this class provides a wrapper to those\n * \"large object\", and avoid ImmerJs to recursively freeze it by pre-freeze itself.\n *\n * Use it with `Immutable` to inform Redux-toolkit and ImmerJS that this type should be ignored from `drafting`\n * Usage:\n * ```\n    import {Immutable} from 'immer';\n\n    interface YourState {\n      someDom: Immutable<Refrigerator<HTMLElement>>;\n    }\n * ```\n */\nexport class Refrigerator {\n    constructor(originRef) {\n        this.ref = originRef;\n        Object.freeze(this);\n    }\n    creatNewIfNoEqual(ref) {\n        if (this.ref !== ref) {\n            return new Refrigerator(ref);\n        }\n        else {\n            return this;\n        }\n    }\n    getRef() {\n        return this.ref;\n    }\n}\nRefrigerator[immerable] = false;\n","/* eslint-disable no-console */\nimport { ofPayloadAction, StateFactory } from './redux-toolkit-observable';\nimport { enableES5, enableMapSet } from 'immer';\nimport { tap } from 'rxjs/operators';\nenableES5();\nenableMapSet();\nexport const stateFactory = module.hot && module.hot.data && module.hot.data.stateFactory ? module.hot.data.stateFactory :\n    new StateFactory({});\nlet sub;\nif (process.env.NODE_ENV === 'development' || (process.env.REACT_APP_env && process.env.REACT_APP_env !== 'prod')) {\n    sub = stateFactory.log$.pipe(tap(params => {\n        if (params[0] === 'state')\n            console.log('%c redux:state ', 'font-weight: bold; color: black; background: #44c2fd;', ...params.slice(1));\n        else if (params[0] === 'action')\n            console.log('%c redux:action ', 'font-weight: bold; color: white; background: #8c61ff;', ...params.slice(1));\n        else\n            console.log(...params);\n    })).subscribe();\n}\nexport { ofPayloadAction };\nif (module.hot) {\n    module.hot.dispose(data => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        data.stateFactory = stateFactory;\n        sub.unsubscribe();\n    });\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app-bar-header\":\"AppLayout_app-bar-header__1I8eY\",\"withShadow\":\"AppLayout_withShadow__3psPI\",\"app-bar-main\":\"AppLayout_app-bar-main__1X8Sh\",\"container\":\"AppLayout_container__1smc9\",\"backLayer\":\"AppLayout_backLayer__eTQiN\",\"frontLayer\":\"AppLayout_frontLayer__1GYKB\",\"progressBarContainer\":\"AppLayout_progressBarContainer__2LAC6\",\"routeProgressBar\":\"AppLayout_routeProgressBar__32FLZ\",\"footer\":\"AppLayout_footer__TQ9z3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"scope\":\"SwitchAnim_scope__24V-j\",\"full\":\"SwitchAnim_full__3ClDN\",\"movingBox\":\"SwitchAnim_movingBox__2GNSL\",\"animate-opacity\":\"SwitchAnim_animate-opacity__39ENY\",\"enterStart\":\"SwitchAnim_enterStart__1WF_m\",\"entering\":\"SwitchAnim_entering__1JAL8\",\"leaving\":\"SwitchAnim_leaving__32ZVo\"};","import React from 'react';\nimport { createSlice } from './tiny-redux-toolkit';\nimport * as op from 'rxjs/operators';\nimport * as rx from 'rxjs';\nexport * from './tiny-redux-toolkit';\nfunction withBaseReducers(origReducers) {\n    const reducers = Object.assign({ _syncComponentProps(s, payload) {\n            s.componentProps = Object.assign({}, payload);\n        },\n        _willUnmount(s) { } }, origReducers);\n    return reducers;\n}\n/**\n * Unlike useTinyReduxTookit, useTinyRtk() accepts a State which extends BaseComponentState,\n *  useTinyRtk() will automatically create an extra reducer \"_syncComponentProps\" for shallow coping\n * React component's properties to this internal RTK store\n * @param optsFactory\n * @param props\n * @param epicFactories\n * @returns\n */\nexport function useTinyRtk(optsFactory, props, ...epicFactories) {\n    const extendOptsFactory = React.useCallback(() => {\n        const opts = optsFactory();\n        return Object.assign(Object.assign({}, opts), { reducers: withBaseReducers(opts.reducers) });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    React.useEffect(() => () => {\n        stateAndSlice[1].actionDispatcher._willUnmount();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    const stateAndSlice = useTinyReduxTookit(extendOptsFactory, ...epicFactories);\n    React.useEffect(() => {\n        stateAndSlice[1].actionDispatcher._syncComponentProps(props);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, Object.values(props));\n    return stateAndSlice;\n}\n/**\n * For performance reason, better define opts.reducers outside of component rendering function\n * @param opts\n * @returns\n */\nexport function useTinyReduxTookit(optsFactory, ...epicFactories) {\n    // To avoid a mutatable version is passed in\n    // const clonedState = clone(opts.initialState);\n    const willUnmountSub = React.useMemo(() => new rx.ReplaySubject(1), []);\n    const sliceOptions = React.useMemo(optsFactory, [optsFactory]);\n    const epic$s = React.useMemo(() => {\n        return epicFactories.map(() => new rx.BehaviorSubject(null));\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    const [state, setState] = React.useState(sliceOptions.initialState);\n    // const [slice, setSlice] = React.useState<Slice<S, R>>();\n    const slice = React.useMemo(() => {\n        const slice = createSlice(sliceOptions);\n        slice.state$.pipe(op.distinctUntilChanged(), op.observeOn(rx.animationFrameScheduler), // To avoid changes being batched by React setState()\n        op.tap(changed => setState(changed)), op.takeUntil(willUnmountSub)).subscribe();\n        // Important!!\n        // Epic might contain recurive state changing logic, like subscribing on state$ stream and \n        // change state, it turns out any subscriber that subscribe state$ later than\n        // epic will get a state change event in reversed order !! So epic must be the last one to\n        // subscribe state$ stream\n        for (const epicFac$ of epic$s) {\n            slice.addEpic$(epicFac$);\n        }\n        // Let's fun epic factory as earlier as possible, so that it will not missing\n        // any action dispatched from child component, since child component's useEffect()\n        // runs earlier than parent component's\n        epicFactories.forEach((fac, idx) => epic$s[idx].next(fac));\n        return slice;\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    React.useEffect(() => {\n        epicFactories.forEach((fac, idx) => epic$s[idx].next(fac));\n    }, [epic$s, epicFactories]);\n    React.useEffect(() => {\n        // const sub = slice.state$.pipe(\n        //   op.distinctUntilChanged(),\n        //   // Important!!! because this stream is subscribed later than Epic,\n        //   // \"changed\" value might\n        //   // come in reversed order in case of recursive state changing in \"Epic\",\n        //   // so always use getValue() to get latest state\n        //   op.tap(() => setState(slice.state$.getValue()))\n        // ).subscribe();\n        return () => {\n            willUnmountSub.next();\n            willUnmountSub.complete();\n            // sub.unsubscribe();\n            slice.destroy();\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    return [state, slice];\n}\n","/**\n * This file provide some hooks which leverages RxJS to mimic Redux-toolkit + Redux-observable\n * which is supposed to be used independently within any React component in case your component has\n * complicated async state change logic.\n *\n * - it is small and supposed to be well performed\n * - it does not use ImmerJS, you should take care of immutability of state by yourself\n * - because there is no ImmerJS, you can put any type of Object in state including those are not friendly by ImmerJS\n */\nimport * as rx from 'rxjs';\nimport * as op from 'rxjs/operators';\nexport function ofPayloadAction(...actionCreators) {\n    return function (src) {\n        return src.pipe(op.filter(action => actionCreators.some(ac => action.type === ac.type)));\n    };\n}\n/**\n * Map action stream to multiple action streams by theire action type.\n * This is an alternative way to categorize action stream, compare to \"ofPayloadAction()\"\n * Usage:\n```\nslice.addEpic(slice => action$ => {\n  const actionsByType = castByActionType(slice.actions, action$);\n  return merge(\n    actionsByType.REDUCER_NAME_A.pipe(\n      ...\n    ),\n    actionsByType.REDUCER_NAME_B.pipe(\n      ...\n    ),\n  )\n})\n```\n * @param actionCreators\n * @param action$\n */\nexport function castByActionType(actionCreators, action$) {\n    const dispatcherByType = {};\n    const splitActions = {};\n    let sourceSub;\n    let subscriberCnt = 0;\n    const source = action$.pipe(\n    // op.share(), we don't need share(), we have implemented same logic\n    op.map(action => {\n        const match = dispatcherByType[action.type];\n        if (match) {\n            match.next(action);\n        }\n    }));\n    for (const reducerName of Object.keys(actionCreators)) {\n        const subject = dispatcherByType[actionCreators[reducerName].type] = new rx.Subject();\n        // eslint-disable-next-line no-loop-func\n        splitActions[reducerName] = rx.defer(() => {\n            if (subscriberCnt++ === 0)\n                sourceSub = source.subscribe();\n            return subject.asObservable();\n        }).pipe(\n        // eslint-disable-next-line no-loop-func\n        op.finalize(() => {\n            if (--subscriberCnt === 0 && sourceSub) {\n                sourceSub.unsubscribe();\n                sourceSub = undefined;\n            }\n        }));\n    }\n    return splitActions;\n}\nexport function isActionOfCreator(action, actionCreator) {\n    return action.type === actionCreator.type;\n}\nconst sliceCount4Name = {};\n/**\n * Reducers and initialState are reused cross multiple component\n *\n *  Slice --- Component instance (state, actions)\n */\nexport function createSlice(opt) {\n    let name = opt.name;\n    if (opt.generateId === undefined || opt.generateId === true) {\n        if (sliceCount4Name[name] == null) {\n            sliceCount4Name[name] = 0;\n        }\n        opt.name = name = name + '.' + (++sliceCount4Name[name]);\n    }\n    const actionCreators = {};\n    const actionDispatcher = {};\n    for (const [key, reducer] of Object.entries(opt.reducers)) {\n        const type = name + '/' + key;\n        const creator = ((payload) => {\n            const action = { type, payload, reducer };\n            return action;\n        });\n        creator.type = type;\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        actionCreators[key] = creator;\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        actionDispatcher[key] = ((payload) => {\n            const action = creator(payload);\n            dispatch(action);\n            return action;\n        });\n        actionDispatcher[key].type = creator.type;\n    }\n    const state$ = new rx.BehaviorSubject(opt.initialState);\n    const unprocessedAction$ = new rx.Subject();\n    const action$ = new rx.Subject();\n    function ofType(...actionTypes) {\n        return function (src) {\n            return src.pipe(op.filter(action => actionTypes.some(ac => action.type === name + '/' + ac)));\n        };\n    }\n    function dispatch(action) {\n        unprocessedAction$.next(action);\n    }\n    let actionCount = 0;\n    let executingReducer = false;\n    // To warn developer that no action dispatching shoud be called inside a reducer, this is side-effects and \n    // will leads to recursive reducer\n    let inReducer = false;\n    const sub = rx.merge(unprocessedAction$.pipe(\n    // op.observeOn(rx.queueScheduler), // Avoid recursively dispatching action inside an reducer, but normally recursively dispatching should be warned and forbidden\n    op.tap(action => {\n        if (opt.debug) {\n            // eslint-disable-next-line no-console\n            console.log(`%c ${name} internal:action `, 'color: black; background: #fae4fc;', action.type);\n        }\n    }), op.tap(action => {\n        if (action.reducer) {\n            const currState = state$.getValue();\n            const shallowCopied = Object.assign(Object.assign({}, currState), { __ac: ++actionCount });\n            executingReducer = true;\n            if (inReducer) {\n                throw new Error(`Do not dispatch action inside a reducer! (action: ${action.type})`);\n            }\n            inReducer = true;\n            let newState;\n            try {\n                newState = action.reducer(shallowCopied, action.payload);\n            }\n            finally {\n                inReducer = false;\n                executingReducer = false;\n            }\n            // inReducer = false;\n            // executingReducer = false;\n            const changed = newState ? newState : shallowCopied;\n            state$.next(changed);\n        }\n        action$.next(action);\n    }), op.catchError((err, caught) => {\n        console.error(err);\n        dispatch({ type: 'reducer error', reducer(s) {\n                return Object.assign(Object.assign({}, s), { error: err });\n            }\n        });\n        return caught;\n    })), state$.pipe(op.tap(state => {\n        if (opt.debug) {\n            // eslint-disable-next-line no-console\n            console.log(`%c ${name} internal:state `, 'color: black; background: #e98df5;', state);\n        }\n    })), opt.rootStore ? state$.pipe(op.tap(state => { var _a; return opt.rootStore.next(Object.assign(Object.assign({}, (_a = opt.rootStore) === null || _a === void 0 ? void 0 : _a.getValue()), { [opt.name]: state })); })) : rx.EMPTY).subscribe();\n    function destroy() {\n        dispatch({\n            type: '__OnDestroy'\n        });\n        sub.unsubscribe();\n    }\n    function addEpic$(epicFactory$) {\n        const sub = epicFactory$.pipe(op.distinctUntilChanged(), op.switchMap(fac => {\n            if (fac) {\n                const epic = fac(slice, ofType);\n                if (epic)\n                    return epic(action$, state$);\n            }\n            return rx.EMPTY;\n        }), op.takeUntil(unprocessedAction$.pipe(op.filter(action => action.type === '__OnDestroy'), op.take(1))), op.tap(action => dispatch(action)), op.catchError((err, caught) => {\n            console.error(err);\n            dispatch({ type: 'epic error', reducer(s) {\n                    return Object.assign(Object.assign({}, s), { error: err });\n                }\n            });\n            return caught;\n        })).subscribe();\n        return () => sub.unsubscribe();\n    }\n    const slice = {\n        name,\n        state$,\n        action$,\n        actions: actionCreators,\n        dispatch,\n        actionDispatcher,\n        destroy,\n        destroy$: unprocessedAction$.pipe(op.filter(action => action.type === '__OnDestroy'), op.take(1)),\n        addEpic(epicFactory) {\n            return addEpic$(rx.of(epicFactory));\n        },\n        addEpic$,\n        getStore() {\n            return state$;\n        },\n        getState() {\n            if (executingReducer) {\n                throw new Error('To be consistent with Redux\\'s behaviour, slice.getState() is not allowed to be invoked inside a reducer');\n            }\n            return state$.getValue();\n        }\n    };\n    return slice;\n}\n/**\n * Add an epicFactory to another component's sliceHelper\n * e.g.\n * ```\n * action$.pipe(ofPayloadAction(slice.actionDispatcher._onChildSliceRef),\n *  childSliceOp((childSlice) => {\n *    return childAction$ => {\n *      return childAction$.pipe(...);\n *    };\n *  })\n * ```\n * @param epicFactory\n */\nexport function sliceRefActionOp(epicFactory) {\n    return function (in$) {\n        return in$.pipe(op.switchMap(({ payload }) => {\n            const release = payload.addEpic(epicFactory);\n            return new rx.Observable(sub => release);\n        }));\n    };\n}\nconst demoSlice = createSlice({\n    name: 'demo',\n    initialState: {},\n    reducers: {\n        hellow(s, greeting) { },\n        world(s) { }\n    }\n});\ndemoSlice.addEpic((slice, ofType) => {\n    return (action$, state$) => {\n        const actionStreams = castByActionType(slice.actions, action$);\n        // slice.actionDispatcher.abc();\n        return rx.merge(actionStreams.hellow.pipe(), action$.pipe(ofType('hellow', 'hellow'), op.map(action => slice.actions.world())), action$.pipe(ofType('world'), op.tap(action => slice.actionDispatcher.hellow({ data: 'yes' }))), action$.pipe(ofPayloadAction(slice.actions.hellow), op.tap(action => typeof action.payload.data === 'string')), action$.pipe(ofPayloadAction(slice.actions.world), op.tap(action => slice.actionDispatcher.hellow({ data: 'yes' }))), action$.pipe(ofPayloadAction(slice.actionDispatcher.hellow, slice.actionDispatcher.world), op.tap(action => action.payload))).pipe(op.ignoreElements());\n    };\n});\n","/// <reference lib=\"es2017\" />\n/// <reference path=\"./hmr-module.d.ts\" />\n// eslint-disable  max-line-length member-ordering\n/**\n * A combo set for using Redux-toolkit along with redux-observable\n */\nimport { combineReducers, configureStore, createSlice as reduxCreateSlice } from '@reduxjs/toolkit';\nimport { createEpicMiddleware, ofType } from 'redux-observable';\nimport { BehaviorSubject, ReplaySubject, Subject } from 'rxjs';\nimport { distinctUntilChanged, filter, map, mergeMap, take, takeUntil, tap, catchError } from 'rxjs/operators';\nexport function ofPayloadAction(...actionCreators) {\n    return ofType(...actionCreators.map(c => c.type));\n}\nconst defaultSliceReducers = {\n    _change: (state, action) => {\n        action.payload(state);\n    }\n};\nexport class StateFactory {\n    constructor(preloadedState) {\n        this.preloadedState = preloadedState;\n        this.store$ = new BehaviorSubject(undefined);\n        /**\n         * same as store.dispatch(action), but this one goes through Redux-observable's epic middleware\n         */\n        this.actionsToDispatch = new ReplaySubject(20);\n        this.epicSeq = 0;\n        // private globalChangeActionCreator = createAction<(draftState: Draft<any>) => void>('__global_change');\n        this.debugLog = new ReplaySubject(15);\n        this.errorHandleMiddleware = (api) => {\n            return (next) => {\n                return (action) => {\n                    try {\n                        // console.log('action in errorHandleMiddleware', action.type);\n                        this.debugLog.next(['action', action != null ? action.type : action]);\n                        const ret = next(action);\n                        return ret;\n                    }\n                    catch (err) {\n                        // tslint:disable-next-line no-console\n                        console.error('[redux-toolkit-observable] failed action', action);\n                        // tslint:disable-next-line no-console\n                        console.error('[redux-toolkit-observable] action dispatch error', err);\n                        this.reportActionError(err);\n                        throw err;\n                    }\n                };\n            };\n        };\n        this.realtimeState$ = new BehaviorSubject(preloadedState);\n        this.epicWithUnsub$ = new ReplaySubject();\n        this.log$ = this.debugLog.asObservable();\n        this.reducerMap = {};\n        this.rootStoreReady = this.store$.pipe(filter(store => store != null), take(1)).toPromise();\n        const errorSlice = this.newSlice(errorSliceOpt);\n        this.errorSlice = errorSlice;\n        this.reportActionError = this.bindActionCreators(errorSlice).reportActionError;\n    }\n    // configureStore(middlewares?: Middleware[]): this;\n    /**\n     *\n     * @param opt Be aware, turn off option \"serializableCheck\" and \"immutableCheck\" from Redux default middlewares\n     */\n    configureStore(opt) {\n        if (this.store$.getValue())\n            return this;\n        const rootReducer = this.createRootReducer();\n        const epicMiddleware = createEpicMiddleware();\n        let cfgOpt = opt;\n        const ourMiddlwares = [this.errorHandleMiddleware, epicMiddleware];\n        if (cfgOpt) {\n            cfgOpt.reducer = rootReducer;\n            cfgOpt.devTools = false;\n            if (cfgOpt.middleware) {\n                const exitingMid = cfgOpt.middleware;\n                if (typeof exitingMid === 'function') {\n                    cfgOpt.middleware = (getDefault) => {\n                        return [...exitingMid(getDefault), ...ourMiddlwares];\n                    };\n                }\n                else {\n                    cfgOpt.middleware = [...exitingMid, ...ourMiddlwares];\n                }\n            }\n            else {\n                cfgOpt.middleware = (getDefault) => {\n                    return [...getDefault({ serializableCheck: false, immutableCheck: false }), ...ourMiddlwares];\n                };\n            }\n        }\n        else {\n            cfgOpt = {\n                reducer: rootReducer,\n                middleware(getDefault) {\n                    return [...getDefault({ serializableCheck: false, immutableCheck: false }), ...ourMiddlwares];\n                },\n                devTools: false\n            };\n        }\n        const store = configureStore(cfgOpt);\n        this.store$.next(store);\n        store.subscribe(() => {\n            const state = store.getState();\n            this.realtimeState$.next(state);\n        });\n        this.realtimeState$.pipe(distinctUntilChanged(), \n        // tap(() => console.log('state changed')),\n        tap(state => this.debugLog.next(['state', state]))).subscribe();\n        epicMiddleware.run((action$, state$, dependencies) => {\n            return this.epicWithUnsub$.pipe(tap(([epic, epicId, unsub]) => {\n                this.debugLog.next([`[redux-toolkit-obs] ${epicId} is about to be subscribed`]);\n                // console.log(`[redux-toolkit-obs] ${epicId} is about to be subscribed`);\n            }), mergeMap(([epic, epicId, unsub]) => (epic(action$, state$, dependencies))\n                .pipe(\n            // tap(action => console.log('action: ', action.type)),\n            takeUntil(unsub.pipe(take(1), map(epicId => {\n                this.debugLog.next(['[redux-toolkit-obs]', `unsubscribe from ${epicId}`]);\n                // console.log(`[redux-toolkit-obs] unsubscribe ${epicId}`);\n            }))), catchError((err, src) => {\n                this.reportActionError(err);\n                console.error(err);\n                return src;\n            }))), takeUntil(action$.pipe(ofType('STOP_EPIC'), tap(() => this.debugLog.next(['[redux-toolkit-obs]', 'Stop all epics'])))));\n        });\n        this.addEpic((action$) => {\n            return this.actionsToDispatch;\n        }, 'internalDispatcher');\n        return this;\n    }\n    /**\n     * Create our special slice with a default reducer action:\n     * - `change(state: Draft<S>, action: PayloadAction<(draftState: Draft<SS>) => void>)`\n     * - initialState is loaded from StateFactory's partial preloadedState\n     */\n    newSlice(opt) {\n        const _opt = opt;\n        const reducers = _opt.reducers;\n        if (reducers._change == null)\n            Object.assign(_opt.reducers, defaultSliceReducers);\n        if (reducers._init == null) {\n            reducers._init = (draft, action) => {\n                this.debugLog.next(['[redux-toolkit-obs]', `slice \"${opt.name}\" is created ${action.payload.isLazy ? 'lazily' : ''}`]);\n            };\n        }\n        if (this.preloadedState && this.preloadedState[opt.name]) {\n            Object.assign(opt.initialState, this.preloadedState[opt.name]);\n        }\n        const slice = reduxCreateSlice(opt);\n        this.addSliceMaybeReplaceReducer(slice);\n        return slice;\n    }\n    removeSlice(slice) {\n        delete this.reducerMap[slice.name];\n        if (this.getRootStore()) {\n            this.debugLog.next(['[redux-toolkit-obs]', 'remove slice ' + slice.name]);\n            const newRootReducer = this.createRootReducer();\n            this.getRootStore().replaceReducer(newRootReducer);\n        }\n    }\n    /**\n     * @returns a function to unsubscribe from this epic\n     * @param epic\n     * @param epicName a name for debug and logging purpose\n     */\n    addEpic(epic, epicName) {\n        const epicId = 'Epic-' + (epicName || ++this.epicSeq);\n        const unsubscribeEpic = new Subject();\n        this.debugLog.next([`[redux-toolkit-obs] ${epicId} is added`]);\n        this.epicWithUnsub$.next([epic, epicId, unsubscribeEpic]);\n        return () => {\n            unsubscribeEpic.next(epicId);\n            unsubscribeEpic.complete();\n        };\n    }\n    sliceState(slice) {\n        const store = this.getRootStore();\n        return store ? store.getState()[slice.name] : {};\n    }\n    sliceStore(slice) {\n        return this.realtimeState$.pipe(map(s => s[slice.name]), filter(ss => ss != null), distinctUntilChanged());\n    }\n    getErrorState() {\n        return this.sliceState(this.errorSlice);\n    }\n    getErrorStore() {\n        return this.sliceStore(this.errorSlice);\n    }\n    dispatch(action) {\n        // console.log('dispatch', action.type);\n        this.actionsToDispatch.next(action);\n    }\n    /**\n     * Unlink Redux's bindActionCreators, our store is lazily created, dispatch is not available at beginning.\n     * Parameter is a Slice instead of action map\n     */\n    bindActionCreators(slice) {\n        const actionMap = {};\n        for (const [name, actionCreator] of Object.entries(slice.actions)) {\n            const doAction = (...param) => {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n                const action = actionCreator(...param);\n                this.dispatch(action);\n                return action;\n            };\n            doAction.type = actionCreator.type;\n            actionMap[name] = doAction;\n        }\n        return actionMap;\n    }\n    stopAllEpics() {\n        this.store$.pipe(tap(store => {\n            if (store)\n                store.dispatch({ payload: null, type: 'STOP_EPIC' });\n        }), take(1)).subscribe();\n    }\n    getRootStore() {\n        return this.store$.getValue();\n    }\n    addSliceMaybeReplaceReducer(slice) {\n        this.reducerMap[slice.name] = slice.reducer;\n        if (this.getRootStore()) {\n            const newRootReducer = this.createRootReducer();\n            this.getRootStore().replaceReducer(newRootReducer);\n            this.dispatch(slice.actions._init({ isLazy: true }));\n        }\n        else {\n            this.dispatch(slice.actions._init({ isLazy: false }));\n        }\n        return slice;\n    }\n    createRootReducer() {\n        return combineReducers(this.reducerMap);\n    }\n}\n/**\n * Simplify reducers structure required in Slice creation option.\n *\n * Normally, to create a slice, you need to provide a slice option paramter like:\n * {name: <name>, initialState: <value>, reducers: {\n *  caseReducer(state, {payload}: PayloadAction<PayloadType>) {\n *    // manipulate state draft with destructored payload data\n *  }\n * }}\n *\n * Unconvenient thing is the \"PayloadAction<PayloadType>\" part which specified as second parameter in every case reducer definition,\n * actually we only care about the Payload type instead of the whole PayloadAction in case reducer.\n *\n * this function accept a simplified version of \"case reducer\" in form of:\n * {\n *    [caseName]: (Draft<State>, payload: any) => Draft<State> | void;\n * }\n *\n * return a regular Case reducers, not longer needs to \"destructor\" action paramter to get payload data.\n *\n * @param payloadReducers\n * @returns\n */\nexport function fromPaylodReducer(payloadReducers) {\n    const reducers = {};\n    for (const [caseName, simpleReducer] of Object.entries(payloadReducers)) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        reducers[caseName] = function (s, action) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n            return simpleReducer(s, action.payload);\n        };\n    }\n    return reducers;\n}\nconst errorSliceOpt = {\n    initialState: {},\n    name: 'error',\n    reducers: {\n        reportActionError(s, { payload }) {\n            s.actionError = payload;\n        }\n    }\n};\nif (module.hot) {\n    module.hot.decline();\n}\n"],"sourceRoot":""}